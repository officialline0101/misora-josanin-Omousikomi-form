<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           åŸºæœ¬è¨­å®šãƒ»ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
           ========================================= */
        :root {
            --primary-color: #88c0a3; /* å„ªã—ã„è‹¥è‰è‰² */
            --primary-dark: #6fa58a;  /* æ¿ƒã„ç·‘ */
            --accent-color: #f29f8f;  /* å„ªã—ã„ã‚µãƒ¼ãƒ¢ãƒ³ãƒ”ãƒ³ã‚¯ */
            --text-color: #5a4e4e;    /* æŸ”ã‚‰ã‹ã„èŒ¶é»’ */
            --bg-color: #fcfdfa;      /* æ¥µè–„ã„ã‚¯ãƒªãƒ¼ãƒ ãƒ›ãƒ¯ã‚¤ãƒˆ */
            --container-bg: #ffffff;
            --input-bg: #f7f9f8;
            --border-radius: 12px;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: linear-gradient(to bottom, #fcfdfa 0%, #f0f6f3 100%);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
            line-height: 1.6;
        }

        /* =========================================
           ã‚³ãƒ³ãƒ†ãƒŠ
           ========================================= */
        .container {
            background-color: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(136, 192, 163, 0.15);
            width: 95%;
            max-width: 520px;
            padding: 30px 25px;
            box-sizing: border-box;
            margin: 0 auto;
            position: relative;
        }

        h1 {
            color: var(--primary-dark);
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 30px 0;
            padding-bottom: 15px;
            border-bottom: 2px dashed #cce3d8;
        }
        
        h1::before {
            content: "ğŸŒ¿";
            display: block;
            font-size: 24px;
            margin-bottom: 5px;
        }

        /* =========================================
           å³ç«¯ãƒŠãƒ“
           ========================================= */
        .side-nav {
            position: fixed;
            right: 10px;
            top: 85%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 30px;
            z-index: 1000;
            width: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .side-nav a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .side-nav a span {
            font-size: 16px;
            margin-bottom: -5px;
        }

        /* =========================================
           ãƒ©ãƒ™ãƒ«ãƒ»å…¥åŠ›ã‚¨ãƒªã‚¢
           ========================================= */
        .label {
            display: flex;
            align-items: center;
            margin: 25px 0 10px 0;
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 16px;
        }
        
        .label::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 1.2em;
            background-color: var(--accent-color);
            margin-right: 10px;
            border-radius: 3px;
        }

        .labeltyuuou {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        .labeltyuuou .highlight-text {
            background-color: #fef5f3;
            padding: 5px 20px;
            border-radius: 20px;
            color: var(--text-color);
            font-weight: bold;
        }

        .required {
            background-color: var(--accent-color);
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
            font-weight: normal;
        }

        .info-text {
            font-size: 13px;
            color: #888;
            text-align: center;
            margin-bottom: 15px;
        }

        input[type="text"],
        input[type="tel"],
        input[type="date"],
        textarea,
        select.datetime-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            background-color: var(--input-bg);
            border-radius: var(--border-radius);
            font-size: 16px;
            color: var(--text-color);
            box-sizing: border-box;
            transition: all 0.3s;
            margin-bottom: 10px;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary-color);
            background-color: #fff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(136, 192, 163, 0.2);
        }

        /* =========================================
           æ—¥æ™‚é¸æŠç”¨ã®ã‚«ã‚¹ã‚¿ãƒ CSS
           ========================================= */
        .dt-grid {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .dt-grid .datetime-input {
            flex: 1; /* æ¨ªä¸¦ã³ */
            margin-bottom: 0;
            cursor: pointer;
            appearance: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŸ¢å°ã‚’æ¶ˆã™ */
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2388c0a3' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .time-disabled {
            opacity: 0.5;
            pointer-events: none;
            background-color: #eee;
        }

        /* =========================================
           ãƒœã‚¿ãƒ³é¡
           ========================================= */
        .visit-buttons,
        .symptoms,
        .menu-sections,
        .irradiations {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .visit-buttons button,
        .symptoms button,
        .menu-sections button,
        .irradiations button {
            flex: 1;
            padding: 12px 10px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            color: var(--text-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 15px;
            font-family: inherit;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            min-width: 45%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .visit-buttons button.active,
        .symptoms button.active,
        .menu-sections button.active,
        .irradiations button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(136, 192, 163, 0.4);
        }

        /* =========================================
           ç¢ºèªã‚¨ãƒªã‚¢ & é€ä¿¡
           ========================================= */
        #displayInfo {
            background-color: #fdfdfd;
            border: 2px dashed #e0e0e0;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin: 10px 0;
        }
        
        .info-row p {
            margin: 0;
            font-size: 15px;
        }

        .edit-button {
            background-color: transparent;
            color: #888;
            border: 1px solid #ccc !important;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 15px;
            min-width: auto !important;
            flex: none !important;
        }
        
        .edit-button:hover {
            background-color: #eee;
            color: #333;
        }

        hr {
            border: none;
            border-top: 1px dotted #ccc;
            margin: 10px 0;
        }

        .submit-button {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            background-color: var(--accent-color);
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(242, 159, 143, 0.4);
            transition: all 0.3s;
            margin-top: 20px;
        }

        .submit-button:hover {
            background-color: #e08e7e;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(242, 159, 143, 0.5);
        }

        /* ãã®ä»–èª¿æ•´ */
        #treatment-text {
            background-color: #f4fbf7;
            border: none;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            color: var(--text-color);
            box-shadow: none;
        }

        .menu-section { display: none; }
        .menu-section.active { display: block; }
    </style>
</head>

<body>
    <div class="side-nav" id="sideNav">
        <a href="#section-message">
            <span>â‡©</span>
            <i class="fas fa-comment"></i>
        </a>
    </div>

    <div class="container">
        <h1>ã¿ãã‚‰åŠ©ç”£é™¢<br>ãŠç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </h1>

        <div class="label" id="resTypeLabel">äºˆç´„å½¢å¼<span class="required">å¿…é ˆ</span></div>
        <div class="visit-buttons">
            <button type="button" id="typeClinic" onclick="selectReservationType(this)">æ¥é™¢äºˆç´„</button>
            <button type="button" id="typeVisit" onclick="selectReservationType(this)">è¨ªå•äºˆç´„</button>
        </div>

        <div class="label">ãŠå®¢æ§˜å<span class="required">å¿…é ˆ</span></div>
        <input type="text" id="name" placeholder="ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="saveInput('name')">

        <div class="label">é›»è©±ç•ªå·<span class="required">å¿…é ˆ</span></div>
        <input type="tel" id="phone" placeholder="é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="saveInput('phone')">

        <div class="label">å‡ºç”£æ—¥ï¼ˆäºˆå®šæ—¥ï¼‰</div>
        <input type="date" id="birthDate" oninput="saveInput('birthDate'); updateDisplayInfo();">

        <div class="label">ã”åˆ©ç”¨å›æ•°<span class="required">å¿…é ˆ</span></div>
        <div class="visit-buttons">
            <button type="button" id="firstVisit" onclick="selectVisit(this)">1å›ç›®</button>
            <button type="button" id="repeatVisit" onclick="selectVisit(this)">2å›ç›®</button>
        </div>

        <div class="label" id="course">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¸ã³ãã ã•ã„<span class="required">å¿…é ˆ</span></div>
        <div class="info-text">â€»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã™ã‚‹ã¨æ‰€è¦æ™‚é–“ç­‰ã®ç›®å®‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        <div class="menu-sections">
            <button type="button" onclick="showMenu('male')">ç”£å¾Œã‚±ã‚¢</button>
            <button type="button" onclick="showMenu('female')">ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸</button>
            <button type="button" onclick="showMenu('whitening')">å€‹åˆ¥ç›¸è«‡</button>
        </div>

        <div id="selected-menus-display" style="display: none; text-align: center; margin-top: 10px;"></div>
        <div id="treatment-text" style="display: none; margin-bottom: 10px;"></div>

        <div id="male" class="menu-section">
            <div class="labeltyuuou"><span class="highlight-text">ç”£å¾Œã‚±ã‚¢</span></div>
            <div class="info-text">â–¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¸ã³ãã ã•ã„â–¼</div>
            <div class="symptoms">
                <button type="button" onclick="selectSymptom(this)" data-category="ç”£å¾Œã‚±ã‚¢" data-price="0">ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿã‚ã‚Šï¼ˆ6æ™‚é–“ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="ç”£å¾Œã‚±ã‚¢" data-price="0">ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿã‚ã‚Šï¼ˆ7æ™‚é–“ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="ç”£å¾Œã‚±ã‚¢" data-price="0">ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿã‚ã‚Šï¼ˆ8æ™‚é–“ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="ç”£å¾Œã‚±ã‚¢" data-price="0">ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿãªã—ï¼ˆ3æ™‚é–“ï¼‰</button>
            </div>
            <div class="labeltyuuou"><span class="highlight-text">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span></div>
            <div class="irradiations">
                <button type="button" onclick="selectirradiations(this)" data-price="15000">ä¸Šã®å­åˆ©ç”¨</button>
                <button type="button" onclick="selectirradiations(this)" data-price="15000">æ—¦é‚£æ§˜ã®åŒå¸­</button>
            </div>
        </div>

        <div id="female" class="menu-section">
            <div class="labeltyuuou"><span class="highlight-text">ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸</span></div>
            <div class="info-text">â–¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¸ã³ãã ã•ã„â–¼</div>
            <div class="symptoms">
                <button type="button" onclick="selectSymptom(this)" data-category="ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸" data-price="0">ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸ï¼ˆãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œãƒ»90åˆ†ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸" data-price="0">ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸ï¼ˆä¹³æˆ¿ã‚±ã‚¢ãƒ»30åˆ†ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸" data-price="0">ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸ï¼ˆå’ä¹³ã‚±ã‚¢ãƒ»30åˆ†ï¼‰</button>
            </div>
            <div class="labeltyuuou"><span class="highlight-text">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span></div>
            <div class="irradiations">
                <button type="button" onclick="selectirradiations(this)" data-price="15000">ä¸Šã®å­åˆ©ç”¨</button>
                <button type="button" onclick="selectirradiations(this)" data-price="15000">æ—¦é‚£æ§˜ã®åŒå¸­</button>
            </div>
        </div>

        <div id="whitening" class="menu-section">
            <div class="labeltyuuou"><span class="highlight-text">å€‹åˆ¥ç›¸è«‡</span></div>
            <div class="info-text">â–¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¸ã³ãã ã•ã„â–¼</div>
            <div class="symptoms">
                <button type="button" onclick="selectSymptom(this)" data-category="å€‹åˆ¥ç›¸è«‡" data-price="0">å¦Šå¨ ä¸­ã®ç›¸è«‡ï¼ˆ30åˆ†ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="å€‹åˆ¥ç›¸è«‡" data-price="0">è‚²å…ç›¸è«‡ï¼ˆ30åˆ†ï¼‰</button>
                <button type="button" onclick="selectSymptom(this)" data-category="å€‹åˆ¥ç›¸è«‡" data-price="0">ä¸¡è¦ªå­¦ç´šï¼ˆ60åˆ†ï¼‰</button>
            </div>
            <div class="labeltyuuou"><span class="highlight-text">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span></div>
            <div class="irradiations">
                <button type="button" onclick="selectirradiations(this)" data-price="15000">ä¸Šã®å­åˆ©ç”¨</button>
                <button type="button" onclick="selectirradiations(this)" data-price="15000">æ—¦é‚£æ§˜ã®åŒå¸­</button>
            </div>
        </div>

        <div class="label" id="kibou1">å¸Œæœ›æ—¥æ™‚1<span class="required">å¿…é ˆ</span></div>
        <div class="datetime-wrapper">
            <input type="hidden" id="date1" name="date1">
            <div class="dt-grid">
                <select id="date1_day" class="datetime-input" aria-label="æ—¥ä»˜ã‚’é¸æŠ"></select>
                <select id="date1_time" class="datetime-input" aria-label="æ™‚é–“ã‚’é¸æŠ"></select>
            </div>
        </div>

        <div class="label" id="kibou2">å¸Œæœ›æ—¥æ™‚2<span class="required">å¿…é ˆ</span></div>
        <div class="datetime-wrapper">
            <input type="hidden" id="date2" name="date2">
            <div class="dt-grid">
                <select id="date2_day" class="datetime-input" aria-label="æ—¥ä»˜ã‚’é¸æŠ"></select>
                <select id="date2_time" class="datetime-input" aria-label="æ™‚é–“ã‚’é¸æŠ"></select>
            </div>
        </div>

        <div class="label" id="kibou3">å¸Œæœ›æ—¥æ™‚3<span class="required">å¿…é ˆ</span></div>
        <div class="datetime-wrapper">
            <input type="hidden" id="date3" name="date3">
            <div class="dt-grid">
                <select id="date3_day" class="datetime-input" aria-label="æ—¥ä»˜ã‚’é¸æŠ"></select>
                <select id="date3_time" class="datetime-input" aria-label="æ™‚é–“ã‚’é¸æŠ"></select>
            </div>
        </div>
        <div class="label">ç”£å¾Œã‚±ã‚¢ã”å¸Œæœ›ã®æ–¹ã¯åˆ©ç”¨åˆ¸ã®ç•ªå·ã‚’ã”è¨˜å…¥ãã ã•ã„<br></div>
        <textarea id="message" rows="4" placeholder="åˆ©ç”¨åˆ¸ã‚’ãŠæŒã¡ã®æ–¹ã¯ç•ªå·ã‚’ã”è¨˜å…¥ãã ã•ã„"></textarea>

        <div class="label">ã”äºˆç´„å†…å®¹</div>
        <div id="displayInfo"></div> 
        <button class="submit-button" onclick="submitForm()" id="section-message">ç”³è¾¼</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        // Javascript
        let reservationType = ''; // è¿½åŠ ï¼šäºˆç´„å½¢å¼
        let visitCount = '';
        let selectedMenu = '';
        let selectedSymptom = [];
        let irradiationsCount = '';
        let totalAmount = 0;
        let menuPrice = 0;
        let optionsPrice = 0;

        // è¨ªå•å›æ•°ã”ã¨ã®æ™‚é–“è¨­å®š
        let visitTimes = { '1å›ç›®': 0, '2å›ç›®': 0 };
        let selectedVisitTime = 0;

        // ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚é–“è¨­å®š
        let irradiationsTimes = { 'ç¾ç™½ãƒ‘ãƒƒã‚¯ã€ˆ30åˆ†ã€‰': 0 };
        let selectedirradiationsTime = 0;

        let menuTimes = {
            'ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿã‚ã‚Šï¼ˆ6æ™‚é–“ï¼‰': 360,
            'ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿã‚ã‚Šï¼ˆ7æ™‚é–“ï¼‰': 420,
            'ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿã‚ã‚Šï¼ˆ8æ™‚é–“ï¼‰': 480,
            'ç”£å¾Œã‚±ã‚¢ãƒ»æ˜¼é£Ÿãªã—ï¼ˆ3æ™‚é–“ï¼‰': 210,
            'ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸ï¼ˆãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œãƒ»90åˆ†ï¼‰': 120,
            'ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸ï¼ˆä¹³æˆ¿ã‚±ã‚¢ãƒ»30åˆ†ï¼‰': 60,
            'ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸ï¼ˆå’ä¹³ã‚±ã‚¢ãƒ»30åˆ†ï¼‰': 60,
            'å¦Šå¨ ä¸­ã®ç›¸è«‡ï¼ˆ30åˆ†ï¼‰': 60,
            'è‚²å…ç›¸è«‡ï¼ˆ30åˆ†ï¼‰': 60,
            'ä¸¡è¦ªå­¦ç´šï¼ˆ60åˆ†ï¼‰': 90
        };
        let selectedMenuTime = 0;

        /* ========== æ—¥æ™‚é¸æŠç”¨ãƒ­ã‚¸ãƒƒã‚¯ ========== */
        const JP_WD = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        const pad = n => String(n).padStart(2, '0');

        const WEEKLY_HOURS = {
            0: { start: 10, end: 16 }, 
            1: { start: 10, end: 18 }, 
            2: { start: 10, end: 18 }, 
            3: { start: 10, end: 18 }, 
            4: { start: 10, end: 18 }, 
            5: { start: 10, end: 18 }, 
            6: { start: 10, end: 16 }  
        };

        function buildDateOptions(selectEl, days = 120, startDate = new Date()) {
            const d = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
            selectEl.innerHTML = '<option value="" disabled selected>æ—¥ä»˜ã‚’é¸æŠ</option>';
            for (let i = 0; i < days; i++) {
                const wd = d.getDay();
                if (wd !== 1 && wd !== 2) {
                    const y = d.getFullYear();
                    const m = pad(d.getMonth() + 1);
                    const day = pad(d.getDate());
                    const value = `${y}-${m}-${day}`;
                    const label = `${y}/${m}/${day}ï¼ˆ${JP_WD[wd]}ï¼‰`;
                    const opt = document.createElement('option');
                    opt.value = value;
                    opt.textContent = label;
                    selectEl.appendChild(opt);
                }
                d.setDate(d.getDate() + 1);
            }
        }

        function isBlockedTime(weekday, h, m) {
            const minutes = h * 60 + m;
            if (weekday >= 1 && weekday <= 5) {
                if (minutes >= 12 * 60 && minutes <= 13 * 60 + 30) return true;
            }
            if (weekday === 0 || weekday === 6) {
                if (minutes >= 12 * 60 && minutes <= 13 * 60) return true;
            }
            return false;
        }

        function buildHalfHourOptions(selectEl, weekday) {
            selectEl.innerHTML = '<option value="" disabled selected>æ™‚é–“ã‚’é¸æŠ</option>';
            if (weekday === 1 || weekday === 2) return;
            const { start, end } = WEEKLY_HOURS[weekday] || { start: 0, end: 23 };
            for (let h = start; h <= end; h++) {
                for (const m of [0, 30]) {
                    if (isBlockedTime(weekday, h, m)) continue;
                    const hh = pad(h);
                    const mm = pad(m);
                    const opt = document.createElement('option');
                    opt.value = `${hh}:${mm}`;
                    opt.textContent = `${hh}:${mm}`;
                    selectEl.appendChild(opt);
                }
            }
        }

        function updateHiddenAndPlaceholder(baseId) {
            const day = document.getElementById(`${baseId}_day`).value;
            const time = document.getElementById(`${baseId}_time`).value;
            const hidden = document.getElementById(baseId);
            hidden.value = day && time ? `${day}T${time}` : "";
            saveInput(baseId);
            updateDisplayInfo();
        }

        function restoreIfAny(baseId) {
            const val = localStorage.getItem(baseId);
            if (!val) return;
            const hidden = document.getElementById(baseId);
            hidden.value = val;
            const [d, t] = val.split('T');
            const daySel = document.getElementById(`${baseId}_day`);
            const timeSel = document.getElementById(`${baseId}_time`);
            if (d) {
                if (![...daySel.options].some(o => o.value === d)) {
                    const tmp = document.createElement('option');
                    tmp.value = d; 
                    tmp.textContent = d.replaceAll('-', '/') + 'ï¼ˆé¸æŠæ—¥ï¼‰';
                    daySel.appendChild(tmp);
                }
                daySel.value = d;
                const wd = new Date(d).getDay();
                buildHalfHourOptions(timeSel, wd);
                timeSel.classList.remove('time-disabled');
            }
            if (t) {
                const t5 = t.slice(0, 5);
                if ([...timeSel.options].some(o => o.value === t5)) timeSel.value = t5;
            }
        }

        function initPicker(baseId, dateDays = 120) {
            const daySel = document.getElementById(`${baseId}_day`);
            const timeSel = document.getElementById(`${baseId}_time`);
            buildDateOptions(daySel, dateDays);
            if (!timeSel.innerHTML.includes('option')) {
                 timeSel.innerHTML = '<option value="" disabled selected>æ™‚é–“ã‚’é¸æŠ</option>';
            }
            timeSel.classList.add('time-disabled');
            daySel.addEventListener('change', () => {
                const dateVal = daySel.value;
                if (dateVal) {
                    const d = new Date(dateVal);
                    const wd = d.getDay();
                    buildHalfHourOptions(timeSel, wd);
                    timeSel.classList.remove('time-disabled');
                } else {
                    timeSel.innerHTML = '<option value="" disabled selected>æ™‚é–“ã‚’é¸æŠ</option>';
                    timeSel.classList.add('time-disabled');
                }
                updateHiddenAndPlaceholder(baseId);
            });
            timeSel.addEventListener('change', () => updateHiddenAndPlaceholder(baseId));
            restoreIfAny(baseId);
        }

        /* ========== åˆæœŸåŒ– ========== */
        document.addEventListener('DOMContentLoaded', function () {
            liff.init({
                liffId: '2008660993-jKWLQg15'
            }).then(() => {
                console.log('LIFFåˆæœŸåŒ–æˆåŠŸ');
            }).catch((err) => {
                console.log('LIFFåˆæœŸåŒ–å¤±æ•—', err);
            });
            ['date1', 'date2', 'date3'].forEach(id => initPicker(id, 120));
        });

        function saveInput(id) {
            const value = document.getElementById(id).value;
            localStorage.setItem(id, value);
        }

        document.addEventListener('DOMContentLoaded', function () {
            const ids = ['name', 'phone', 'birthDate'];
            ids.forEach(id => {
                const val = localStorage.getItem(id);
                if (val) document.getElementById(id).value = val;
            });
        });

        // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        document.querySelectorAll('.side-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 20,
                        behavior: 'smooth'
                    });
                }
            });
        });

        function formatDt(dt) {
            if (!dt) return 'æŒ‡å®šãªã—';
            const [d, t] = dt.split('T');
            if (!d || !t) return 'æŒ‡å®šãªã—';
            const [y, m, day] = d.split('-');
            return `${y}å¹´${m}æœˆ${day}æ—¥ ${t}`;
        }

        /* ========== è¿½åŠ ï¼šäºˆç´„å½¢å¼ã®é¸æŠãƒ­ã‚¸ãƒƒã‚¯ ========== */
        function selectReservationType(element) {
            document.getElementById('typeClinic').classList.remove('active');
            document.getElementById('typeVisit').classList.remove('active');
            element.classList.add('active');
            reservationType = element.innerText;
            updateDisplayInfo();
        }

        /* ========== è¡¨ç¤ºæƒ…å ±ã®æ›´æ–° ========== */
        function updateDisplayInfo() {
            const name = document.getElementById('name').value;
            const birthDate = document.getElementById('birthDate').value;
            
            const resTypeText = reservationType ? `<span style="color:#5a4e4e;"><strong>äºˆç´„å½¢å¼</strong></span>ï¼š${reservationType}` : 'ãƒ»äºˆç´„å½¢å¼ãŒæœªé¸æŠã§ã™';
            const birthDateText = birthDate ? `<span style="color:#5a4e4e;"><strong>å‡ºç”£äºˆå®šæ—¥</strong></span>ï¼š${birthDate}` : 'ãƒ»å‡ºç”£äºˆå®šæ—¥ãŒæœªé¸æŠã§ã™';
            const visitCountText = visitCount ? `<span style="color:#5a4e4e;"><strong>å›æ•°</strong></span>ï¼š${visitCount}` : 'ãƒ»åˆ©ç”¨å›æ•°ãŒæœªé¸æŠã§ã™';
            
            const selectedSymptomText = selectedSymptom.length > 0
                ? `<span style="color:#5a4e4e;"><strong>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</strong></span><br>ãƒ»${selectedSymptom.map(item => `ã€Š${item.category}ã€‹${item.name}`).join('<br>ãƒ»')}`
                : 'ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒæœªé¸æŠã§ã™';
            
            const d1 = document.getElementById('date1').value;
            const d2 = document.getElementById('date2').value;
            const d3 = document.getElementById('date3').value;
            const dateText = `<span style="color:#5a4e4e;"><strong>å¸Œæœ›æ—¥æ™‚</strong></span><br>1: ${formatDt(d1)}<br>2: ${formatDt(d2)}<br>3: ${formatDt(d3)}`;

            document.getElementById('displayInfo').innerHTML = `
                <div class="info-row">
                    <p>${resTypeText}</p>
                    <button class="edit-button" onclick="scrollToElement('resTypeLabel')">ä¿®æ­£</button>
                </div>
                <hr>
                <div class="info-row">
                    <p><span style="color:#5a4e4e;"><strong>ãŠåå‰</strong></span>ï¼š${name}</p>
                    <button class="edit-button" onclick="scrollToElement('name')">ä¿®æ­£</button>
                </div>
                <hr>
                <div class="info-row">
                    <p>${birthDateText}</p>
                    <button class="edit-button" onclick="scrollToElement('birthDate')">ä¿®æ­£</button>
                </div>
                <hr>
                <div class="info-row">
                    <p>${visitCountText}</p>
                    <button class="edit-button" onclick="scrollToElement('firstVisit')">ä¿®æ­£</button>
                </div>
                <hr>
                <div class="info-row">
                    <p>${selectedSymptomText}</p>
                    <button class="edit-button" onclick="scrollToElement('male')">ä¿®æ­£</button>
                </div>
                <hr>
                <div class="info-row">
                    <p>${dateText}</p>
                    <button class="edit-button" onclick="scrollToElement('kibou1')">ä¿®æ­£</button>
                </div>
            `;
        }

        function scrollToElement(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // å…¥åŠ›ç›£è¦–
        document.getElementById('name').addEventListener('input', updateDisplayInfo);

        /* ========== ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠãƒ­ã‚¸ãƒƒã‚¯ ========== */
        function selectSymptom(button) {
            const selectedMenusDisplay = document.getElementById("selected-menus-display");
            if (button.classList.contains('active')) {
                button.classList.remove('active');
            } else {
                const activeCount = document.querySelectorAll('.symptoms button.active').length;
                if (activeCount >= 3) return;
                button.classList.add('active');
            }

            const updatedSelectedButtons = document.querySelectorAll('.symptoms button.active');
            selectedSymptom = [];
            updatedSelectedButtons.forEach((btn) => {
                const selectedMenuName = btn.textContent;
                const category = btn.getAttribute('data-category');
                selectedSymptom.push({ category, name: selectedMenuName });
            });

            if (selectedSymptom.length > 0) {
                selectedMenusDisplay.innerHTML = `
                    <div class="menu-items-wrapper">
                        ${selectedSymptom.map(item => `
                            <div class="menu-item">
                                <span>ã€Š${item.category}ã€‹<br>${item.name}</span>
                                <button class="remove-button" data-category="${item.category}" data-name="${item.name}" onclick="removeSymptom(this)">âœ•</button>
                            </div>
                        `).join('')}
                    </div>`;
                selectedMenusDisplay.style.display = 'block';
            } else {
                selectedMenusDisplay.style.display = 'none';
            }
            updateDisplayInfo();
        }

        function removeSymptom(button) {
            const name = button.getAttribute('data-name');
            const srcBtn = [...document.querySelectorAll('.symptoms button')].find(b => b.textContent === name);
            if (srcBtn) srcBtn.classList.remove('active');
            selectSymptom(srcBtn); // å†è¨ˆç®—
        }

        function selectirradiations(button) {
            button.classList.toggle('active');
            const selectedButtons = document.querySelectorAll('.irradiations button.active');
            irradiationsCount = Array.from(selectedButtons).map(btn => btn.innerText).join(', ');
            updateDisplayInfo();
        }

        function selectVisit(element) {
            document.getElementById('firstVisit').classList.remove('active');
            document.getElementById('repeatVisit').classList.remove('active');
            element.classList.add('active');
            visitCount = element.innerText;
            updateDisplayInfo();
        }

        function showMenu(menu) {
            document.querySelectorAll('.menu-sections button').forEach(button => button.classList.remove('active'));
            document.querySelectorAll('.menu-section').forEach(section => section.classList.remove('active'));
            
            const selectedButton = document.querySelector(`.menu-sections button[onclick="showMenu('${menu}')"]`);
            if (selectedButton) selectedButton.classList.add('active');
            document.getElementById(menu).classList.add('active');
            updateDisplayInfo();
        }

        /* ========== é€ä¿¡å‡¦ç† ========== */
        function submitForm() {
            const formData = {
                resType: reservationType,
                name: document.getElementById('name').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                birthDate: document.getElementById('birthDate').value,
                visitCount: visitCount,
                selectedSymptom: selectedSymptom,
                irradiationsCount: irradiationsCount,
                date1: document.getElementById('date1').value,
                date2: document.getElementById('date2').value,
                date3: document.getElementById('date3').value,
                message: document.getElementById('message').value.trim()
            };

            if (!formData.resType) { alert('äºˆç´„å½¢å¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'); return; }
            if (!formData.name) { alert('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
            if (!formData.phone) { alert('é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
            if (!formData.visitCount) { alert('ã”åˆ©ç”¨å›æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'); return; }
            if (formData.selectedSymptom.length === 0) { alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'); return; }
            if (!formData.date1 && !formData.date2 && !formData.date3) { alert('å¸Œæœ›æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }

            const symptomText = formData.selectedSymptom.map(item => item.name).join(',');
            const datesText = `\nç¬¬1å¸Œæœ›: ${formatDt(formData.date1)}\nç¬¬2å¸Œæœ›: ${formatDt(formData.date2)}\nç¬¬3å¸Œæœ›: ${formatDt(formData.date3)}`;

            liff.sendMessages([{
                type: 'text',
                text: `ã€ãŠç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ã€‘\näºˆç´„å½¢å¼ï¼š${formData.resType}\nãŠåå‰ï¼š${formData.name}\né›»è©±ç•ªå·ï¼š${formData.phone}\nå‡ºç”£äºˆå®šæ—¥ï¼š${formData.birthDate || 'æœªé¸æŠ'}\nåˆ©ç”¨å›æ•°ï¼š${formData.visitCount}\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼š${symptomText}\nã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼š${formData.irradiationsCount || 'ãªã—'}\nå¸Œæœ›æ—¥æ™‚ï¼š${datesText}\nå‚™è€ƒï¼š${formData.message}`
            }]).then(() => {
                alert('ãŠç”³ã—è¾¼ã¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚');
                liff.closeWindow();
            }).catch(err => console.error(err));
        }
    </script>
</body>
</html>
