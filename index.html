<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           åŸºæœ¬è¨­å®šãƒ»ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
           ========================================= */
        :root {
            --primary-color: #88c0a3; /* å„ªã—ã„è‹¥è‰è‰² */
            --primary-dark: #6fa58a;  /* æ¿ƒã„ç·‘ */
            --accent-color: #f29f8f;  /* å„ªã—ã„ã‚µãƒ¼ãƒ¢ãƒ³ãƒ”ãƒ³ã‚¯ */
            --text-color: #5a4e4e;    /* æŸ”ã‚‰ã‹ã„èŒ¶é»’ */
            --bg-color: #fcfdfa;      /* æ¥µè–„ã„ã‚¯ãƒªãƒ¼ãƒ ãƒ›ãƒ¯ã‚¤ãƒˆ */
            --container-bg: #ffffff;
            --input-bg: #f7f9f8;
            --border-radius: 12px;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: linear-gradient(to bottom, #fcfdfa 0%, #f0f6f3 100%);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
            line-height: 1.6;
        }

        .container {
            background-color: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(136, 192, 163, 0.15);
            width: 95%;
            max-width: 520px;
            padding: 30px 25px;
            box-sizing: border-box;
            margin: 0 auto;
            position: relative;
        }

        h1 {
            color: var(--primary-dark);
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 30px 0;
            padding-bottom: 15px;
            border-bottom: 2px dashed #cce3d8;
        }
        
        h1::before {
            content: "ğŸŒ¿";
            display: block;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .side-nav {
            position: fixed;
            right: 10px;
            top: 85%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 30px;
            z-index: 1000;
            width: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .side-nav a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .label {
            display: flex;
            align-items: center;
            margin: 25px 0 10px 0;
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 16px;
        }
        
        .label::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 1.2em;
            background-color: var(--accent-color);
            margin-right: 10px;
            border-radius: 3px;
        }

        .required {
            background-color: var(--accent-color);
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
            font-weight: normal;
        }

        input[type="text"],
        input[type="tel"],
        input[type="date"],
        textarea,
        select.datetime-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            background-color: var(--input-bg);
            border-radius: var(--border-radius);
            font-size: 16px;
            color: var(--text-color);
            box-sizing: border-box;
            transition: all 0.3s;
            margin-bottom: 10px;
            font-family: inherit;
        }

        .dt-grid {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .dt-grid .datetime-input {
            flex: 1;
            margin-bottom: 0;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2388c0a3' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .time-disabled {
            opacity: 0.5;
            pointer-events: none;
            background-color: #eee;
        }

        .visit-buttons,
        .menu-sections {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .visit-buttons button,
        .menu-sections button {
            flex: 1;
            padding: 12px 10px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            color: var(--text-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 15px;
            font-family: inherit;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            min-width: 45%;
        }

        .visit-buttons button.active,
        .menu-sections button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(136, 192, 163, 0.4);
        }

        #displayInfo {
            background-color: #fdfdfd;
            border: 2px dashed #e0e0e0;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .info-row p { margin: 0; font-size: 15px; }

        .edit-button {
            background-color: transparent;
            color: #888;
            border: 1px solid #ccc;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 15px;
            cursor: pointer;
        }

        .submit-button {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            background-color: var(--accent-color);
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(242, 159, 143, 0.4);
            transition: all 0.3s;
            margin-top: 20px;
        }

        hr { border: none; border-top: 1px dotted #ccc; margin: 10px 0; }
    </style>
</head>

<body>
    <div class="side-nav" id="sideNav">
        <a href="#section-message">
            <span>â‡©</span>
            <i class="fas fa-comment"></i>
        </a>
    </div>

    <div class="container">
        <h1>ã¿ãã‚‰åŠ©ç”£é™¢<br>ãŠç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </h1>

        <div class="label">ãŠå®¢æ§˜å<span class="required">å¿…é ˆ</span></div>
        <input type="text" id="name" placeholder="ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="saveInput('name'); updateDisplayInfo();">

        <div class="label">é›»è©±ç•ªå·<span class="required">å¿…é ˆ</span></div>
        <input type="tel" id="phone" placeholder="é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="saveInput('phone'); updateDisplayInfo();">

        <div class="label">å‡ºç”£æ—¥ï¼ˆäºˆå®šæ—¥ï¼‰</div>
        <input type="date" id="birthDate" oninput="saveInput('birthDate'); updateDisplayInfo();">

        <div class="label">ã”åˆ©ç”¨å›æ•°<span class="required">å¿…é ˆ</span></div>
        <div class="visit-buttons">
            <button type="button" id="firstVisit" onclick="selectVisit(this)">1å›ç›®</button>
            <button type="button" id="repeatVisit" onclick="selectVisit(this)">2å›ç›®</button>
        </div>

        <div class="label" id="course">ã”å¸Œæœ›ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„<span class="required">å¿…é ˆ</span></div>
        <div class="menu-sections">
            <button type="button" onclick="selectCourse(this)">ç”£å¾Œã‚±ã‚¢</button>
            <button type="button" onclick="selectCourse(this)">ä¹³æˆ¿ãƒãƒƒã‚µãƒ¼ã‚¸</button>
            <button type="button" onclick="selectCourse(this)">å€‹åˆ¥ç›¸è«‡</button>
        </div>

        <div class="label" id="kibou1">å¸Œæœ›æ—¥æ™‚1<span class="required">å¿…é ˆ</span></div>
        <div class="datetime-wrapper">
            <input type="hidden" id="date1" name="date1">
            <div class="dt-grid">
                <select id="date1_day" class="datetime-input"></select>
                <select id="date1_time" class="datetime-input"></select>
            </div>
        </div>

        <div class="label" id="kibou2">å¸Œæœ›æ—¥æ™‚2<span class="required">å¿…é ˆ</span></div>
        <div class="datetime-wrapper">
            <input type="hidden" id="date2" name="date2">
            <div class="dt-grid">
                <select id="date2_day" class="datetime-input"></select>
                <select id="date2_time" class="datetime-input"></select>
            </div>
        </div>

        <div class="label" id="kibou3">å¸Œæœ›æ—¥æ™‚3<span class="required">å¿…é ˆ</span></div>
        <div class="datetime-wrapper">
            <input type="hidden" id="date3" name="date3">
            <div class="dt-grid">
                <select id="date3_day" class="datetime-input"></select>
                <select id="date3_time" class="datetime-input"></select>
            </div>
        </div>

        <div class="label">å‚™è€ƒï¼ˆç”£å¾Œã‚±ã‚¢åˆ©ç”¨åˆ¸ç•ªå·ãªã©ï¼‰</div>
        <textarea id="message" rows="4" placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„"></textarea>

        <div class="label">ã”äºˆç´„å†…å®¹ç¢ºèª</div>
        <div id="displayInfo"></div> 
        <button class="submit-button" onclick="submitForm()" id="section-message">ç”³è¾¼</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        let visitCount = '';
        let selectedMenu = '';

        /* ========== æ—¥æ™‚é¸æŠç”¨ãƒ­ã‚¸ãƒƒã‚¯ ========== */
        const JP_WD = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        const pad = n => String(n).padStart(2, '0');
        const WEEKLY_HOURS = { 0: null, 1: {start:9, end:16}, 2: {start:9, end:16}, 3: {start:9, end:16}, 4: {start:9, end:16}, 5: {start:9, end:16}, 6: {start:9, end:16} };

        function buildDateOptions(selectEl, days = 120) {
            const d = new Date();
            selectEl.innerHTML = '<option value="" disabled selected>æ—¥ä»˜ã‚’é¸æŠ</option>';
            for (let i = 0; i < days; i++) {
                const wd = d.getDay();
                if (wd !== 0) {
                    const y = d.getFullYear();
                    const m = pad(d.getMonth() + 1);
                    const day = pad(d.getDate());
                    const opt = document.createElement('option');
                    opt.value = `${y}-${m}-${day}`;
                    opt.textContent = `${y}/${m}/${day}ï¼ˆ${JP_WD[wd]}ï¼‰`;
                    selectEl.appendChild(opt);
                }
                d.setDate(d.getDate() + 1);
            }
        }

        function buildHalfHourOptions(selectEl, weekday) {
            selectEl.innerHTML = '<option value="" disabled selected>æ™‚é–“ã‚’é¸æŠ</option>';
            const { start, end } = WEEKLY_HOURS[weekday] || { start: 9, end: 16 };
            for (let h = start; h <= end; h++) {
                for (const m of [0, 30]) {
                    if (h === 12) continue; // ä¼‘æ†©
                    const opt = document.createElement('option');
                    opt.value = `${pad(h)}:${pad(m)}`;
                    opt.textContent = `${pad(h)}:${pad(m)}`;
                    selectEl.appendChild(opt);
                }
            }
        }

        function initPicker(baseId) {
            const daySel = document.getElementById(`${baseId}_day`);
            const timeSel = document.getElementById(`${baseId}_time`);
            buildDateOptions(daySel);
            timeSel.classList.add('time-disabled');

            daySel.addEventListener('change', () => {
                if (daySel.value) {
                    buildHalfHourOptions(timeSel, new Date(daySel.value).getDay());
                    timeSel.classList.remove('time-disabled');
                }
                updateHidden(baseId);
            });
            timeSel.addEventListener('change', () => updateHidden(baseId));
        }

        function updateHidden(baseId) {
            const d = document.getElementById(`${baseId}_day`).value;
            const t = document.getElementById(`${baseId}_time`).value;
            document.getElementById(baseId).value = d && t ? `${d}T${t}` : "";
            updateDisplayInfo();
        }

        /* ========== ãƒ•ã‚©ãƒ¼ãƒ åˆ¶å¾¡ ========== */
        function selectVisit(btn) {
            document.querySelectorAll('.visit-buttons button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            visitCount = btn.innerText;
            updateDisplayInfo();
        }

        function selectCourse(btn) {
            document.querySelectorAll('.menu-sections button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            selectedMenu = btn.innerText;
            updateDisplayInfo();
        }

        function saveInput(id) { localStorage.setItem(id, document.getElementById(id).value); }

        function formatDt(dt) {
            if (!dt) return 'æœªé¸æŠ';
            const [d, t] = dt.split('T');
            return `${d.replace(/-/g, '/')} ${t}`;
        }

        function updateDisplayInfo() {
            const name = document.getElementById('name').value || 'æœªå…¥åŠ›';
            const d1 = document.getElementById('date1').value;
            const d2 = document.getElementById('date2').value;
            const d3 = document.getElementById('date3').value;

            document.getElementById('displayInfo').innerHTML = `
                <div class="info-row"><p><strong>ãŠåå‰</strong>ï¼š${name}</p></div><hr>
                <div class="info-row"><p><strong>å›æ•°</strong>ï¼š${visitCount || 'æœªé¸æŠ'}</p></div><hr>
                <div class="info-row"><p><strong>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</strong>ï¼š${selectedMenu || 'æœªé¸æŠ'}</p></div><hr>
                <div class="info-row"><p><strong>å¸Œæœ›æ—¥æ™‚</strong><br>1: ${formatDt(d1)}<br>2: ${formatDt(d2)}<br>3: ${formatDt(d3)}</p></div>
            `;
        }

        function submitForm() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const d1 = document.getElementById('date1').value;

            if (!name || !phone || !visitCount || !selectedMenu || !d1) {
                alert('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const messageText = `ã€ãŠç”³è¾¼ã€‘\nãŠåå‰ï¼š${name}\né›»è©±ç•ªå·ï¼š${phone}\nå›æ•°ï¼š${visitCount}\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼š${selectedMenu}\nç¬¬1å¸Œæœ›ï¼š${formatDt(d1)}\nå‚™è€ƒï¼š${document.getElementById('message').value}`;

            liff.sendMessages([{ type: 'text', text: messageText }]).then(() => {
                alert('é€ä¿¡ã—ã¾ã—ãŸ');
                liff.closeWindow();
            }).catch(err => console.error(err));
        }

        document.addEventListener('DOMContentLoaded', () => {
            liff.init({ liffId: '2008879195-Mya9dL2a' });
            ['date1', 'date2', 'date3'].forEach(initPicker);
            // å¾©å…ƒ
            ['name', 'phone', 'birthDate'].forEach(id => {
                const val = localStorage.getItem(id);
                if (val) document.getElementById(id).value = val;
            });
            updateDisplayInfo();
        });
    </script>
</body>
</html>
